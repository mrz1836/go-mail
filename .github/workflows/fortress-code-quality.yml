# ------------------------------------------------------------------------------------
#  Code Quality (Reusable Workflow) (GoFortress)
#
#  Purpose: Run code quality checks including Go vet (static analysis) and
#  golangci-lint (comprehensive linting).
#
#  Maintainer: @mrz1836
#
# ------------------------------------------------------------------------------------

name: GoFortress (Code Quality)

on:
  workflow_call:
    inputs:
      env-json:
        description: "JSON string of environment variables"
        required: true
        type: string
      primary-runner:
        description: "Primary runner OS"
        required: true
        type: string
      go-primary-version:
        description: "Primary Go version"
        required: true
        type: string
      go-lint-enabled:
        description: "Whether Go linting is enabled"
        required: true
        type: string
      yaml-lint-enabled:
        description: "Whether YAML linting is enabled"
        required: true
        type: string
      static-analysis-enabled:
        description: "Whether static analysis is enabled"
        required: true
        type: string
      go-sum-file:
        description: "Path to go.sum file for dependency verification"
        required: true
        type: string
    outputs:
      golangci-lint-version:
        description: "Version of golangci-lint used in the workflow"
        value: ${{ jobs.lint.outputs.golangci-lint-version }}
      yamlfmt-version:
        description: "Version of yamlfmt used in the workflow"
        value: ${{ jobs.yaml-format.outputs.yamlfmt-version }}
    secrets:
      github-token:
        description: "GitHub token for API access"
        required: true

# Security: Restrictive default permissions with job-level overrides for least privilege access
permissions:
  contents: read

jobs:
  # ----------------------------------------------------------------------------------
  # Go Vet (Static Analysis)
  # ----------------------------------------------------------------------------------
  govet:
    name: ðŸ“Š Govet (Static Analysis)
    if: ${{ inputs.static-analysis-enabled == 'true' }}
    runs-on: ${{ inputs.primary-runner }}
    steps:
      # --------------------------------------------------------------------
      # Checkout code (required for local actions)
      # --------------------------------------------------------------------
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1

      # --------------------------------------------------------------------
      # Parse environment variables
      # --------------------------------------------------------------------
      - name: ðŸ”§ Parse environment variables
        uses: ./.github/actions/parse-env
        with:
          env-json: ${{ inputs.env-json }}

      # --------------------------------------------------------------------
      # Setup Go with caching and version management
      # --------------------------------------------------------------------
      - name: ðŸ—ï¸ Setup Go with Cache
        id: setup-go-vet
        uses: ./.github/actions/setup-go-with-cache
        with:
          go-version: ${{ inputs.go-primary-version }}
          matrix-os: ${{ inputs.primary-runner }}
          go-primary-version: ${{ inputs.go-primary-version }}
          go-secondary-version: ${{ inputs.go-primary-version }}
          go-sum-file: ${{ env.GO_SUM_FILE }}
          enable-multi-module: ${{ env.ENABLE_MULTI_MODULE_TESTING }}

      # --------------------------------------------------------------------
      # Extract Go module directory from GO_SUM_FILE path
      # --------------------------------------------------------------------
      - name: ðŸ”§ Extract Go module directory
        uses: ./.github/actions/extract-module-dir
        with:
          go-sum-file: ${{ env.GO_SUM_FILE }}

      # --------------------------------------------------------------------
      # Setup MAGE-X (required for magex lint command)
      # --------------------------------------------------------------------
      - name: ðŸ”§ Setup MAGE-X
        uses: ./.github/actions/setup-magex
        with:
          magex-version: ${{ env.MAGE_X_VERSION }}
          runner-os: ${{ inputs.primary-runner }}
          use-local: ${{ env.MAGE_X_USE_LOCAL }}

      # --------------------------------------------------------------------
      # Run go vet with sequential execution to avoid memory issues
      # --------------------------------------------------------------------
      - name: ðŸ” Go vet (sequential)
        run: |
          echo "ðŸš€ Running static analysis with go vet (sequential mode)..."
          GO_MODULE_DIR="${{ env.GO_MODULE_DIR }}"

          # Run go vet on packages sequentially to reduce memory usage
          if [ -n "$GO_MODULE_DIR" ]; then
            echo "ðŸ”§ Running go vet from directory: $GO_MODULE_DIR"
            cd "$GO_MODULE_DIR"
          else
            echo "ðŸ”§ Running go vet from repository root"
          fi

          # Get all packages and vet them one at a time
          # Capture go list output and check for errors
          # Discard stderr to avoid capturing download progress messages
          if ! PACKAGES=$(go list ./... 2>/dev/null | grep -v /vendor/); then
            # If command failed, re-run with stderr visible to show the error
            echo "âŒ go list command failed:"
            go list ./... 2>&1 | head -20
            exit 1
          fi

          TOTAL=$(echo "$PACKAGES" | grep -c . || echo 0)
          CURRENT=0

          echo "ðŸ“¦ Found $TOTAL packages to vet"

          if [ "$TOTAL" -eq 0 ]; then
            echo "âš ï¸ No packages found to vet"
            exit 1
          fi

          for pkg in $PACKAGES; do
            CURRENT=$((CURRENT + 1))
            echo "[$CURRENT/$TOTAL] Vetting $pkg..."
            if ! go vet "$pkg"; then
              echo "âŒ go vet failed on package: $pkg"
              exit 1
            fi
          done

          echo "âœ… Static analysis completed successfully"

      # --------------------------------------------------------------------
      # Summary of Go vet results
      # --------------------------------------------------------------------
      - name: ðŸ“Š Job Summary
        run: |
          echo "## ðŸ“Š Go Vet Static Analysis Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Analysis Details | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|---|---|" >> $GITHUB_STEP_SUMMARY
          echo "| **Tool** | go vet (Official Go Static Analyzer) |" >> $GITHUB_STEP_SUMMARY
          echo "| **Execution** | Sequential (memory-optimized) |" >> $GITHUB_STEP_SUMMARY
          echo "| **Scope** | ./... (excludes dependencies) |" >> $GITHUB_STEP_SUMMARY
          echo "| **Result** | âœ… No issues found |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸŽ¯ **All packages passed static analysis checks.**" >> $GITHUB_STEP_SUMMARY

      # --------------------------------------------------------------------
      # Collect cache statistics
      # --------------------------------------------------------------------
      - name: ðŸ“Š Collect cache statistics
        id: cache-stats-govet
        if: always()
        uses: ./.github/actions/collect-cache-stats
        with:
          workflow-name: govet
          job-name: govet
          os: ${{ inputs.primary-runner }}
          go-version: ${{ inputs.go-primary-version }}
          cache-prefix: cache-stats
          gomod-cache-hit: ${{ steps.setup-go-vet.outputs.module-cache-hit }}
          gobuild-cache-hit: ${{ steps.setup-go-vet.outputs.build-cache-hit }}

      # --------------------------------------------------------------------
      # Upload infrastructure cache statistics
      # --------------------------------------------------------------------
      - name: ðŸ“¤ Upload infrastructure cache statistics
        if: always()
        uses: ./.github/actions/upload-statistics
        with:
          artifact-name: cache-stats-govet
          artifact-path: cache-stats-govet.json
          retention-days: 1

  # ----------------------------------------------------------------------------------
  # Lint (Code Linting)
  # ----------------------------------------------------------------------------------
  lint:
    name: âœ¨ Lint Code
    timeout-minutes: 20
    if: ${{ inputs.go-lint-enabled == 'true' }}
    runs-on: ${{ inputs.primary-runner }}
    outputs:
      golangci-lint-version: ${{ steps.golangci-lint-version.outputs.version }}
    steps:
      # --------------------------------------------------------------------
      # Checkout code (required for local actions)
      # --------------------------------------------------------------------
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1

      # --------------------------------------------------------------------
      # Parse environment variables
      # --------------------------------------------------------------------
      - name: ðŸ”§ Parse environment variables
        uses: ./.github/actions/parse-env
        with:
          env-json: ${{ inputs.env-json }}

      - name: ðŸ”§ Set Go cache paths (cross-platform)
        run: |
          echo "ðŸ”§ Setting up Go cache paths..."
          echo "GOCACHE=$HOME/.cache/go-build"        >> $GITHUB_ENV
          echo "GOMODCACHE=$HOME/go/pkg/mod"          >> $GITHUB_ENV
          echo "GOLANGCI_LINT_CACHE=$HOME/.cache/golangci-lint" >> $GITHUB_ENV

      # --------------------------------------------------------------------
      # Setup Go with caching and version management
      # --------------------------------------------------------------------
      - name: ðŸ—ï¸ Setup Go with Cache
        id: setup-go-lint
        uses: ./.github/actions/setup-go-with-cache
        with:
          go-version: ${{ inputs.go-primary-version }}
          matrix-os: ${{ inputs.primary-runner }}
          go-primary-version: ${{ inputs.go-primary-version }}
          go-secondary-version: ${{ inputs.go-primary-version }}
          go-sum-file: ${{ env.GO_SUM_FILE }}
          enable-multi-module: ${{ env.ENABLE_MULTI_MODULE_TESTING }}

      # --------------------------------------------------------------------
      # Extract Go module directory from GO_SUM_FILE path
      # --------------------------------------------------------------------
      - name: ðŸ”§ Extract Go module directory
        uses: ./.github/actions/extract-module-dir
        with:
          go-sum-file: ${{ env.GO_SUM_FILE }}

      # --------------------------------------------------------------------
      # Setup MAGE-X (required for magex lint command)
      # --------------------------------------------------------------------
      - name: ðŸ”§ Setup MAGE-X
        uses: ./.github/actions/setup-magex
        with:
          magex-version: ${{ env.MAGE_X_VERSION }}
          runner-os: ${{ inputs.primary-runner }}
          use-local: ${{ env.MAGE_X_USE_LOCAL }}

      # --------------------------------------------------------------------
      # Capture golangci-lint version for outputs and reporting
      # --------------------------------------------------------------------
      - name: ðŸ” Capture golangci-lint version
        id: golangci-lint-version
        run: |
          echo "version=${{ env.MAGE_X_GOLANGCI_LINT_VERSION }}" >> $GITHUB_OUTPUT

      # --------------------------------------------------------------------
      # Cache golangci-lint binary (prevents re-downloading)
      # --------------------------------------------------------------------
      - name: ðŸ’¾ Restore golangci-lint binary cache
        id: cache-golangci-lint-binary
        uses: actions/cache@9255dc7a253b0ccc959486e2bca901246202afeb # v5.0.1
        with:
          path: ~/.cache/golangci-lint-bin
          key: ${{ inputs.primary-runner }}-golangci-lint-binary-${{ env.MAGE_X_GOLANGCI_LINT_VERSION }}

      # --------------------------------------------------------------------
      # Install cached golangci-lint binary to GOPATH/bin
      # --------------------------------------------------------------------
      - name: ðŸ“¦ Install cached golangci-lint binary
        if: steps.cache-golangci-lint-binary.outputs.cache-hit == 'true'
        run: |
          echo "ðŸ“¦ Restoring cached golangci-lint binary..."
          GOPATH_BIN="$(go env GOPATH)/bin"
          mkdir -p "$GOPATH_BIN"

          if [[ -f ~/.cache/golangci-lint-bin/golangci-lint ]]; then
            cp ~/.cache/golangci-lint-bin/golangci-lint "$GOPATH_BIN/"
            chmod +x "$GOPATH_BIN/golangci-lint"
            echo "âœ… Cached golangci-lint binary installed to $GOPATH_BIN"
            echo "ðŸ“ Version: $(golangci-lint --version | head -n1 || echo 'version check failed')"
          else
            echo "âš ï¸ Cache hit but binary not found, will install via MAGE-X"
          fi

      # --------------------------------------------------------------------
      # Cache golangci-lint build cache (prevents re-compiling)
      # --------------------------------------------------------------------
      - name: ðŸ’¾ Cache golangci-lint build cache
        id: cache-golangci-lint-build
        uses: actions/cache@9255dc7a253b0ccc959486e2bca901246202afeb # v5.0.1
        with:
          path: ~/.cache/go-build
          key: ${{ inputs.primary-runner }}-go-build-golangci-${{ env.MAGE_X_GOLANGCI_LINT_VERSION }}-${{ hashFiles('**/*.go') }}
          restore-keys: |
            ${{ inputs.primary-runner }}-go-build-golangci-${{ env.MAGE_X_GOLANGCI_LINT_VERSION }}-

      # --------------------------------------------------------------------
      # Cache golangci-lint analysis results
      # --------------------------------------------------------------------
      - name: ðŸ’¾ Cache golangci-lint analysis
        id: cache-golangci-lint
        uses: actions/cache@9255dc7a253b0ccc959486e2bca901246202afeb # v5.0.1
        with:
          path: ${{ env.GOLANGCI_LINT_CACHE }}
          key: ${{ inputs.primary-runner }}-golangci-lint-analysis-${{ hashFiles('.golangci.json', env.GO_SUM_FILE) }}-${{ steps.golangci-lint-version.outputs.version }}

      - name: ðŸ” Debug cache usage
        run: |
          echo "ðŸ” Module cache size: $(du -sh $GOMODCACHE 2>/dev/null | cut -f1 || echo 'N/A')"
          echo "ðŸ” Build cache size: $(du -sh $GOCACHE 2>/dev/null | cut -f1 || echo 'N/A')"
          echo "ðŸ” Lint cache size: $(du -sh $GOLANGCI_LINT_CACHE 2>/dev/null | cut -f1 || echo 'N/A')"
          echo "ðŸ” Checking if vendor directory exists: $(ls -la | grep vendor || echo 'No vendor directory')"

      # --------------------------------------------------------------------
      # Run golangci-lint
      # --------------------------------------------------------------------
      - name: âœ¨ Run golangci-lint
        run: |
          echo "ðŸ§¹ Running code linting with golangci-lint..."
          echo "ðŸ’¾ Golangci-lint cache location: $GOLANGCI_LINT_CACHE"
          echo "ðŸ“ Module cache path: $GOMODCACHE"

          # Export the cache directory for golangci-lint
          export GOLANGCI_LINT_CACHE=$GOLANGCI_LINT_CACHE

          GO_MODULE_DIR="${{ env.GO_MODULE_DIR }}"

          if [ "$ENABLE_MULTI_MODULE_TESTING" == "true" ]; then
            echo "ðŸ”§ Multi-module linting enabled - running from repository root"
            echo "ðŸ“¦ magex will discover all Go modules"
            magex lint
          elif [ -n "$GO_MODULE_DIR" ]; then
            echo "ðŸ”§ Running magex lint from directory: $GO_MODULE_DIR"
            (cd "$GO_MODULE_DIR" && magex lint)
          else
            echo "ðŸ”§ Running magex lint from repository root"
            magex lint
          fi

          echo "âœ… Code linting completed successfully"

      # --------------------------------------------------------------------
      # Save golangci-lint binary to cache (on cache miss)
      # --------------------------------------------------------------------
      - name: ðŸ’¾ Save golangci-lint binary to cache
        if: steps.cache-golangci-lint-binary.outputs.cache-hit != 'true'
        run: |
          echo "ðŸ’¾ Caching golangci-lint binary for future runs..."
          GOPATH_BIN="$(go env GOPATH)/bin"
          mkdir -p ~/.cache/golangci-lint-bin

          if [[ -f "$GOPATH_BIN/golangci-lint" ]]; then
            cp "$GOPATH_BIN/golangci-lint" ~/.cache/golangci-lint-bin/
            echo "âœ… golangci-lint binary cached"
            echo "ðŸ“Š Binary size: $(du -h "$GOPATH_BIN/golangci-lint" | cut -f1)"
          else
            echo "âš ï¸ golangci-lint binary not found at $GOPATH_BIN, cannot cache"
          fi

      # --------------------------------------------------------------------
      # Summary of golangci-lint results
      # --------------------------------------------------------------------
      - name: ðŸ“Š Job Summary
        run: |
          echo "## âœ¨ Code Linting Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Linting Details | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|---|---|" >> $GITHUB_STEP_SUMMARY
          echo "| **Configuration** | Custom ruleset via .golangci.json |" >> $GITHUB_STEP_SUMMARY
          echo "| **Version** | ${{ steps.golangci-lint-version.outputs.version }} |" >> $GITHUB_STEP_SUMMARY
          echo "| **Binary Cache** | ${{ steps.cache-golangci-lint-binary.outputs.cache-hit == 'true' && 'ðŸ’š Cache Hit' || 'ðŸ“¦ Downloaded & Cached' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| **Analysis Cache** | ðŸ’¾ Enabled |" >> $GITHUB_STEP_SUMMARY
          echo "| **Result** | âœ… All checks passed |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸŽ¯ **Code quality standards met - no linting issues found.**" >> $GITHUB_STEP_SUMMARY

      # --------------------------------------------------------------------
      # Collect cache statistics
      # --------------------------------------------------------------------
      - name: ðŸ“Š Collect cache statistics
        id: cache-stats-lint
        if: always()
        uses: ./.github/actions/collect-cache-stats
        with:
          workflow-name: lint
          job-name: lint
          os: ${{ inputs.primary-runner }}
          go-version: ${{ inputs.go-primary-version }}
          cache-prefix: cache-stats
          gomod-cache-hit: ${{ steps.setup-go-lint.outputs.module-cache-hit }}
          gobuild-cache-hit: ${{ steps.setup-go-lint.outputs.build-cache-hit }}
          include-golangci: true

      # --------------------------------------------------------------------
      # Upload infrastructure cache statistics
      # --------------------------------------------------------------------
      - name: ðŸ“¤ Upload infrastructure cache statistics
        if: always()
        uses: ./.github/actions/upload-statistics
        with:
          artifact-name: cache-stats-lint
          artifact-path: cache-stats-lint.json
          retention-days: 1

  # ----------------------------------------------------------------------------------
  # YAML/JSON Format Validation (MAGE-X)
  # ----------------------------------------------------------------------------------
  yaml-format:
    name: ðŸ“ YAML/JSON Format Validation
    if: ${{ inputs.yaml-lint-enabled == 'true' }}
    runs-on: ${{ inputs.primary-runner }}
    outputs:
      yamlfmt-version: ${{ steps.yamlfmt-version.outputs.version }}
    steps:
      # --------------------------------------------------------------------
      # Checkout code (required for local actions)
      # --------------------------------------------------------------------
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1

      # --------------------------------------------------------------------
      # Parse environment variables
      # --------------------------------------------------------------------
      - name: ðŸ”§ Parse environment variables
        uses: ./.github/actions/parse-env
        with:
          env-json: ${{ inputs.env-json }}

      # --------------------------------------------------------------------
      # Setup Go with caching and version management
      # --------------------------------------------------------------------
      - name: ðŸ—ï¸ Setup Go with Cache
        id: setup-go-yaml
        uses: ./.github/actions/setup-go-with-cache
        with:
          go-version: ${{ inputs.go-primary-version }}
          matrix-os: ${{ inputs.primary-runner }}
          go-primary-version: ${{ inputs.go-primary-version }}
          go-secondary-version: ${{ inputs.go-primary-version }}
          go-sum-file: ${{ env.GO_SUM_FILE }}
          enable-multi-module: ${{ env.ENABLE_MULTI_MODULE_TESTING }}

      # --------------------------------------------------------------------
      # Extract Go module directory from GO_SUM_FILE path
      # --------------------------------------------------------------------
      - name: ðŸ”§ Extract Go module directory
        uses: ./.github/actions/extract-module-dir
        with:
          go-sum-file: ${{ env.GO_SUM_FILE }}

      # --------------------------------------------------------------------
      # Setup MAGE-X (required for magex format:fix command)
      # --------------------------------------------------------------------
      - name: ðŸ”§ Setup MAGE-X
        uses: ./.github/actions/setup-magex
        with:
          magex-version: ${{ env.MAGE_X_VERSION }}
          runner-os: ${{ inputs.primary-runner }}
          use-local: ${{ env.MAGE_X_USE_LOCAL }}

      # --------------------------------------------------------------------
      # Get yamlfmt version from MAGE-X
      # --------------------------------------------------------------------
      - name: ðŸ” Get yamlfmt version
        id: yamlfmt-version
        run: |
          echo "âœ… Using MAGE-X managed yamlfmt version"
          echo "version=${{ env.MAGE_X_YAMLFMT_VERSION }}" >> $GITHUB_OUTPUT

      # --------------------------------------------------------------------
      # List YAML/JSON files to be formatted (for transparency)
      # --------------------------------------------------------------------
      - name: ðŸ“‹ List YAML/JSON files to check
        run: |
          echo "ðŸ“Š YAML/JSON files that will be validated:"
          find . -type f \( -name "*.yml" -o -name "*.yaml" -o -name "*.json" \) \
            -not -path "./.git/*" \
            -not -path "./vendor/*" \
            -not -path "./node_modules/*" \
            -not -path "./dist/*" \
            -not -path "./build/*" \
            -not -path "./coverage/*" | sort || true

          TOTAL_FILES=$(find . -type f \( -name "*.yml" -o -name "*.yaml" -o -name "*.json" \) \
            -not -path "./.git/*" \
            -not -path "./vendor/*" \
            -not -path "./node_modules/*" \
            -not -path "./dist/*" \
            -not -path "./build/*" \
            -not -path "./coverage/*" | wc -l | xargs)

          echo "TOTAL_FILES=$TOTAL_FILES" >> $GITHUB_ENV
          echo ""
          echo "ðŸ“ˆ Total YAML/JSON files found: $TOTAL_FILES"

      # --------------------------------------------------------------------
      # Run MAGE-X format:check to validate formatting
      # --------------------------------------------------------------------
      - name: ðŸ” Check YAML/JSON formatting with MAGE-X
        run: |
          echo "ðŸ” Checking YAML/JSON file formatting with MAGE-X format:check..."
          echo "ðŸ“„ Configuration file: .github/.yamlfmt"
          echo "ðŸ”§ yamlfmt version: ${{ steps.yamlfmt-version.outputs.version }}"
          echo ""

          GO_MODULE_DIR="${{ env.GO_MODULE_DIR }}"

          # Run magex format:check to validate formatting without modifying files
          if [ -n "$GO_MODULE_DIR" ]; then
            echo "ðŸ”§ Running magex format:check from directory: $GO_MODULE_DIR"
            if (cd "$GO_MODULE_DIR" && magex format:check); then
              echo "âœ… All YAML/JSON files are properly formatted"
            else
              echo "âŒ YAML/JSON formatting issues detected"
              echo ""
              echo "ðŸ”§ To fix these issues locally, run:"
              echo "    cd $GO_MODULE_DIR && magex format:fix"
              echo ""
              echo "ðŸ“š yamlfmt Configuration (.github/.yamlfmt):"
              echo "    â€¢ Indent style: spaces (2 spaces)"
              echo "    â€¢ End of line: LF"
              echo "    â€¢ Final newline: required"
              echo "    â€¢ Line breaks: preserved where sensible"
              echo "    â€¢ Comment padding: 1 space after #"
              exit 1
            fi
          else
            echo "ðŸ”§ Running magex format:check from repository root"
            if magex format:check; then
              echo "âœ… All YAML/JSON files are properly formatted"
            else
              echo "âŒ YAML/JSON formatting issues detected"
              echo ""
              echo "ðŸ”§ To fix these issues locally, run:"
              echo "    magex format:fix"
              echo ""
              echo "ðŸ“š yamlfmt Configuration (.github/.yamlfmt):"
              echo "    â€¢ Indent style: spaces (2 spaces)"
              echo "    â€¢ End of line: LF"
              echo "    â€¢ Final newline: required"
              echo "    â€¢ Line breaks: preserved where sensible"
              echo "    â€¢ Comment padding: 1 space after #"
              exit 1
            fi
          fi

      # --------------------------------------------------------------------
      # Job Summary
      # --------------------------------------------------------------------
      - name: ðŸ“Š Job Summary
        run: |
          echo "## ðŸ“ YAML/JSON Format Validation Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Validation Details | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|---|---|" >> $GITHUB_STEP_SUMMARY
          echo "| **Tool** | MAGE-X format:fix (yamlfmt) |" >> $GITHUB_STEP_SUMMARY
          echo "| **Version** | ${{ steps.yamlfmt-version.outputs.version }} |" >> $GITHUB_STEP_SUMMARY
          echo "| **Configuration** | .github/.yamlfmt |" >> $GITHUB_STEP_SUMMARY
          echo "| **Scope** | All .yml, .yaml, and .json files |" >> $GITHUB_STEP_SUMMARY
          echo "| **Result** | âœ… All files properly formatted |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### File Processing Statistics" >> $GITHUB_STEP_SUMMARY
          echo "- **Total files processed**: ${{ env.TOTAL_FILES }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### yamlfmt Configuration Applied" >> $GITHUB_STEP_SUMMARY
          echo "- **Indent Style**: Spaces (2 spaces)" >> $GITHUB_STEP_SUMMARY
          echo "- **Line Endings**: LF" >> $GITHUB_STEP_SUMMARY
          echo "- **Final Newline**: Required" >> $GITHUB_STEP_SUMMARY
          echo "- **Line Breaks**: Preserved where sensible" >> $GITHUB_STEP_SUMMARY
          echo "- **Comment Padding**: 1 space after #" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸŽ¯ **All YAML/JSON files meet formatting standards via MAGE-X.**" >> $GITHUB_STEP_SUMMARY
